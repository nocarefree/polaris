import{d as T,r as C,o as s,c as p,w as t,a as u,b as o,u as e,N as f,C as j,e as z,f as G,g as x,h as O,i as H,j as J,k as K,l as Q,m as W,I as X,n as Y,p as ee,q as m,s as y,t as b,v as $,D as k,x as N,y as A,F as te,z as ue,A as ne,B as ae,E as le}from"./index.37e0b10d.js";import{r as _}from"./request.aad27b89.js";import{_ as oe}from"./SkeletonList.vue_vue_type_script_setup_true_lang.fbb2f726.js";const ie=T({__name:"ExportButton",props:{disabled:{type:Boolean},loading:{type:Boolean}},emits:["click"],setup(q){const d=C(!1);return(i,r)=>(s(),p(e(x),{variant:"segmented"},{default:t(()=>[u(e(f),{disabled:i.disabled,loading:i.loading,onClick:r[0]||(r[0]=B=>i.$emit("click","shopify")),variant:"primary"},{default:t(()=>[o("\u5BFC\u51FA\u6570\u636E ")]),_:1},8,["disabled","loading"]),u(e(G),{active:d.value,"onUpdate:active":r[2]||(r[2]=B=>d.value=B)},{activator:t(()=>[u(e(f),{disabled:i.disabled||i.loading,icon:e(j),onClick:r[1]||(r[1]=B=>d.value=!d.value),variant:"primary","accessibility-label":"\u66F4\u591A\u5BFC\u51FA"},null,8,["disabled","icon"])]),default:t(()=>[u(e(z),{"action-role":"menuitem",items:[{content:"\u5BFC\u51FAshopify\u8868\u683C",onAction:()=>i.$emit("click","shopify")},{content:"\u5BFC\u51FAshopyy\u8868\u683C",onAction:()=>i.$emit("click","shopyy")}]},null,8,["items"])]),_:1},8,["active"])]),_:1}))}}),se=le("p",null,"\u8BF7\u521B\u5EFA\u4F60\u7684\u4EFB\u52A1",-1),pe=T({__name:"TaskList",setup(q){const d=K(),i=C(!0),r={singular:"tasks",plural:"tasks"},B=[],v=O({total:0,data:[]}),w=C([]),M=H(),h=C(0),S=[{id:"1",content:"\u5168\u90E8"},{id:"2",content:"\u91C7\u96C6\u4E2D"},{id:"3",content:"\u5DF2\u5B8C\u6210"}],I=C([]),V=[{label:"\u4EFB\u52A1\u53F7",value:"task asc",directionLabel:"Ascending"},{label:"\u4EFB\u52A1\u53F7",value:"task desc",directionLabel:"Descending"},{label:"\u7EBF\u7A0B",value:"process asc",directionLabel:"Ascending"},{label:"\u7EBF\u7A0B",value:"process desc",directionLabel:"Ascending"},{label:"\u540D\u79F0",value:"name asc",directionLabel:"A-Z"},{label:"\u540D\u79F0",value:"name desc",directionLabel:"A-Z"},{label:"\u72B6\u6001",value:"status asc",directionLabel:"A-Z"},{label:"\u72B6\u6001",value:"status desc",directionLabel:"A-Z"}],L=C(""),E=()=>{_.get("/tasks").then(n=>{i.value=!1,v.data=n.data,v.total=n.total})};let D=setInterval(E,15e3);E();const U=n=>{const l=n.status=="running"?"stop":"run";n.loading=!0,_.post(`/tasks/${n.id}/action`,{action:l}).then(c=>{n.status=c.status,n.loading=!1})},P=(n,l)=>{n.loading=!0,clearInterval(D),_.post(`/tasks/${n.id}/action`,{action:"export",type:l}).then(({id:c})=>{D=setInterval(E,15e3),n.loading=!1,c&&M.showToast({id:`${n.id}_${c}`,content:"\u5BFC\u51FA\u8BF7\u6C42\u5DF2\u63A5\u6536"})})},Z=n=>{n.loading=!0,_.post(`/tasks/${n.id}/action`,{action:"clearProduct"}).then(({url:l})=>{n.loading=!1,n.parsed=0,n.products_count=0})},R=n=>{n.loading=!0,_.post(`/tasks/${n.id}/action`,{action:"clearMap"}).then(({url:l})=>{n.loading=!1,n.ruled=0,n.map_count=0})};return J(()=>{clearInterval(D)}),(n,l)=>i.value?(s(),p(oe,{key:0})):(s(),p(e(ae),{key:1,title:"\u4EFB\u52A1","full-width":""},{primaryAction:t(()=>[u(e(f),{variant:"primary",onClick:l[0]||(l[0]=c=>e(d).push("/tasks/new"))},{default:t(()=>[o("\u6DFB\u52A0\u4EFB\u52A1")]),_:1})]),default:t(()=>[u(e(ne),{padding:"0"},{default:t(()=>{var c;return[((c=v==null?void 0:v.data)==null?void 0:c.length)>0?(s(),Q(te,{key:0},[u(e(W),{mode:e(X).Default,selected:h.value,"onUpdate:selected":l[1]||(l[1]=g=>h.value=g),tabs:S,"sort-selected":I.value,"onUpdate:sortSelected":l[2]||(l[2]=g=>I.value=g),"sort-options":V,"query-value":L.value,"onUpdate:queryValue":l[3]||(l[3]=g=>L.value=g),filters:B,"can-create-new-view":""},null,8,["mode","selected","sort-selected","query-value"]),u(e(Y),{"resource-name":r,headings:[{title:"ID"},{title:"\u4EFB\u52A1\u540D"},{title:"\u6293\u53D6\u6570\u91CF"},{title:"\u4EA7\u54C1\u6570\u91CF"},{title:"\u72B6\u6001"},{title:"\u72B6\u6001"}],rows:v.data},{default:t(({index:g,row:a})=>[u(e(ee),{id:a.id,selected:w.value=="All"||w.value.includes(a.id),position:g},{default:t(()=>[u(e(m),null,{default:t(()=>[u(e(y),{variant:"bodyMd","font-weight":"bold",as:"span"},{default:t(()=>[u(e(f),{variant:"plain",onClick:F=>e(d).push(`/task/${a.id}`)},{default:t(()=>[o("#"+b(a.id),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),u(e(m),null,{default:t(()=>[u(e(y),null,{default:t(()=>[o(b(a.name),1)]),_:2},1024)]),_:2},1024),u(e(m),null,{default:t(()=>[u(e($),{gap:"200","block-align":"center"},{default:t(()=>[u(e(f),{icon:e(k),variant:"tertiary",loading:a.loading,onClick:F=>R(a)},null,8,["icon","loading","onClick"]),u(e(y),null,{default:t(()=>[o(b(a.maps_count),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),u(e(m),null,{default:t(()=>[u(e($),{gap:"200","block-align":"center"},{default:t(()=>[u(e(f),{icon:e(k),variant:"tertiary",loading:a.loading,onClick:F=>Z(a)},null,8,["icon","loading","onClick"]),u(e(y),null,{default:t(()=>[o(b(a.products_count),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),u(e(m),null,{default:t(()=>[u(e($),{gap:"200","block-align":"center"},{default:t(()=>[a.ruled?(s(),p(e(N),{key:0,tone:"success"},{default:t(()=>[o("\u7F51\u5740\u5DF2\u6293\u53D6")]),_:1})):A("",!0),a.parsed?(s(),p(e(N),{key:1,tone:"success"},{default:t(()=>[o("\u6570\u636E\u5DF2\u89E3\u6790")]),_:1})):A("",!0),a.status=="running"?(s(),p(e(N),{key:2,tone:"attention"},{default:t(()=>[o("\u8FD0\u884C\u4E2D")]),_:1})):A("",!0)]),_:2},1024)]),_:2},1024),u(e(m),null,{default:t(()=>[u(e(x),null,{default:t(()=>[u(e(f),{disabled:a.status=="running"||a.loading=="loading",onClick:F=>e(d).push(`/webs/${a.map.id}/`)},{default:t(()=>[o("\u8BBE\u7F6E\u89C4\u5219 ")]),_:2},1032,["disabled","onClick"]),u(e(f),{pressed:a.status=="running",disabled:a.loading=="loading",onClick:F=>U(a)},{default:t(()=>[o(b(a.status=="running"?"\u6682\u505C\u8FD0\u884C":"\u5F00\u59CB\u8FD0\u884C"),1)]),_:2},1032,["pressed","disabled","onClick"]),a.parsed?(s(),p(ie,{key:0,onClick:F=>P(a,F),loading:a.loading},null,8,["onClick","loading"])):A("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["id","selected","position"])]),_:1},8,["rows"])],64)):(s(),p(e(ue),{key:1,heading:"\u6CA1\u6709\u4EFB\u4F55\u4EFB\u52A1",action:{content:"\u521B\u5EFA\u4EFB\u52A1",url:"/tasks/new"},image:"https://cdn.shopify.com/s/files/1/0262/4071/2726/files/emptystate-files.png","secondary-action":{content:"\u4E86\u89E3\u8BE6\u7EC6\u4FE1\u606F",url:""}},{default:t(()=>[se]),_:1}))]}),_:1})]),_:1}))}});export{pe as default};
