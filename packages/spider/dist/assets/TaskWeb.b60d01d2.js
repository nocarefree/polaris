import{X as Fe,u as e,d as Q,r as E,Y as x,Z as ue,o as d,c as _,w as u,a as t,_ as le,$ as M,E as w,l as U,T as D,U as Ae,N as T,b as F,y as $,a0 as se,R as I,n as K,p as z,q as N,a1 as de,O as G,t as q,F as H,a2 as J,v as S,x as re,a3 as Ce,a4 as Ee,a5 as xe,k as ae,A as ee,a6 as ie,a7 as te,Q as L,a8 as ce,a9 as W,aa as ke,ab as Re,H as Z,J as De,G as fe,K as qe,g as Ve,M as $e,B as Ne}from"./index.37e0b10d.js";import{r as P}from"./request.aad27b89.js";const _e=()=>({id:"",task_id:"0",request:{method:"get",url:""},sended:0}),X=Fe("currentTaskWeb",{state(){return{firstLoading:!0,loading:!1,productLoading:!1,map:{id:"",source_id:"",rule_id:"",next_id:""},data:_e(),prevRule:null,rules:[],product:null}},getters:{responseHeaders(c){let p=[],n=0;if(c.data.response&&c.data.response.headers)for(let a in c.data.response.headers)for(let l of c.data.response.headers[a])p.push({id:`response_header_${n}`,key:a,value:l}),n++;return p},requestOptionsHeaders(c){var a,l;const p=((l=(a=c.data.request)==null?void 0:a.options)==null?void 0:l.headers)||{Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7","Accept-Encoding":"gzip, deflate","Accept-Language":"zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7",Connection:"keep-alive","If-None-Match":'W/"1c8-fEirmDCs8TtsHqbbQ2lzyacFqVo"',"Sec-Ch-Ua":'"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"',"Sec-Ch-Ua-Mobile":"?0","Sec-Ch-Ua-Platform":'"Windows"',"Sec-Fetch-Dest":"document","Sec-Fetch-Mode":"navigate","Sec-Fetch-Site":"none","Sec-Fetch-User":"?1","Upgrade-Insecure-Requests":"1","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"};let n=[];return Object.keys(p).forEach((b,m)=>{n.push({id:`${m+1}`,key:b,value:p[b]})}),n.push({id:`${n.length+1}`,key:"",value:""}),n}},actions:{setRequestOptionsHeaders(c){(typeof this.data.request.options>"u"||Array.isArray(this.data.request.options))&&(this.data.request.options={});let p={};for(let n of c)n.key&&(p[n.key]=n.value);this.data.request.options.headers=p},get(c){this.data=_e(),this.firstLoading=!0,P.get(`/webs/${c}`).then(({map:p,web:n,prev_rule:a,next_rules:l=[]})=>{n&&a&&(this.map=p,this.rules=l,this.data=n,this.prevRule=a,this.firstLoading=!1)})},getResponse(){this.loading=!0,this.data.response={body:"loading",headers:{},status:"404"},P.get(`/webs/${this.map.id}/response`).then(({web:c})=>{c&&(this.data=c,this.loading=!1)})},update(){const{id:c,...p}=e(this.data);this.loading=!0,P.put(`/webs/${this.map.id}`,p).then(n=>{this.loading=!1,n.id&&(this.data=n)})},updateRuleType(c){this.loading=!0,P.put(`/webs/${this.map.id}`,{rule_type:c}).then(p=>{this.loading=!1,p.id&&this.prevRule&&(this.prevRule.type=c)})},getRuleByPosition(c){return JSON.parse(JSON.stringify(this.rules[c]))},addRule(c){var p;this.rules.push({id:"",type:c,content:{type:"area",range:{start:"",end:""}},task_id:this.data.task_id,parent_id:((p=this.prevRule)==null?void 0:p.id)||"0"})},updateRule(c,p){const{id:n}=this.rules[c],{maps:a,...l}=p;return l.map_id=this.map.id,this.loading=!0,new Promise((b,m)=>{(n?P.put(`/rules/${n}`,l):P.post("/rules/",l)).then(h=>{h.id?(this.rules[c]=h,b(h)):m("")}).catch(h=>{m(h)}).finally(()=>{this.loading=!1})})},touchProduct(){this.productLoading=!0,P.post(`/webs/${this.map.id}/product`).then(c=>{c.id&&(this.product=c)}).finally(()=>{this.productLoading=!1})},deleteRule(c){const{id:p}=this.rules[c];p?(this.loading=!0,P.delete(`/rules/${p}`).then(n=>{this.rules.splice(c,1),this.loading=!1})):this.rules.splice(c,1)}}}),Ue={key:1},Te={key:2},Se={class:"language-html line-numbers"},He=Q({__name:"WebClient",emits:{},setup(c,{emit:p}){const n=E(0),a=E(),l=E(),b=E(!1),m=E(!1),h=E(!1),i=X(),g=x(()=>[{id:"request",content:"\u8BF7\u6C42"},{id:"response",content:"\u54CD\u5E94",disabled:!Boolean(i.data.sended)}]),o=E(i.requestOptionsHeaders),f=y=>{o.value.splice(y,1)};ue(()=>o.value,(y,s)=>{let r=s[s.length-1];r.key&&r.value&&o.value.push({id:`${o.value.length+1}`,key:"",value:""})},{deep:!0,flush:"post"});const v=()=>{a.value=void 0,i.data.request.url.length<7&&i.data.request.url.indexOf("http")!==0?a.value="\u65E0\u6548\u94FE\u63A5":(i.setRequestOptionsHeaders(o.value),i.update())},A=()=>{h.value=!h.value,i.data.response||i.getResponse()},B=()=>{let y=document.createElement("textarea");document.body.appendChild(y),y.value=i.data.response.body,y.select(),y.focus(),document.execCommand("copy"),document.body.removeChild(y)};return(y,s)=>(d(),_(e(I),null,{default:u(()=>[t(e(le),{tabs:g.value,selected:n.value,"onUpdate:selected":s[0]||(s[0]=r=>n.value=r)},null,8,["tabs","selected"]),t(e(M)),t(e(xe),null,{default:u(()=>[w("div",null,[n.value==0?(d(),U(H,{key:0},[t(e(D),{disabled:e(i).loading,label:"\u94FE\u63A5",modelValue:e(i).data.request.url,"onUpdate:modelValue":s[2]||(s[2]=r=>e(i).data.request.url=r),placeholder:"\u8BF7\u586B\u5199\u540D\u79F0",error:a.value,style:{"margin-bottom":"20px"}},{connectedLeft:u(()=>[t(e(Ae),{disabled:e(i).loading,"label-hidden":"",label:"method",modelValue:e(i).data.request.method,"onUpdate:modelValue":s[1]||(s[1]=r=>e(i).data.request.method=r),options:[{label:"GET",value:"get"},{label:"POST",value:"post"}]},null,8,["disabled","modelValue"])]),connectedRight:u(()=>[t(e(T),{onClick:v,disabled:Boolean(a.value)||e(i).loading,loading:e(i).loading},{default:u(()=>[F(" \u6293\u53D6 ")]),_:1},8,["disabled","loading"])]),_:1},8,["disabled","modelValue","error"]),e(i).data.request.method=="post"?(d(),_(e(D),{key:0,label:"\u53D1\u9001\u5185\u5BB9",multiline:4,modelValue:e(i).data.request.options.body,"onUpdate:modelValue":s[3]||(s[3]=r=>e(i).data.request.options.body=r)},null,8,["modelValue"])):$("",!0),t(e(T),{variant:"plain",onClick:s[4]||(s[4]=r=>b.value=!b.value)},{default:u(()=>[F("\u8BBE\u7F6E\u8BF7\u6C42\u5934\u90E8")]),_:1}),t(e(se),{open:b.value,"onUpdate:open":s[5]||(s[5]=r=>b.value=r),id:"requestHeadersContent"},{default:u(()=>[t(e(I),{style:{"margin-top":"10px"}},{default:u(()=>[t(e(K),{"resource-name":{singular:"requestHeaders",plural:"requestHeaders"},headings:[{title:"\u952E"},{title:"\u503C"},{title:""}],rows:o.value,"last-column-sticky":""},{default:u(({index:r,row:V})=>[t(e(z),{id:V.id,position:r},{default:u(()=>[t(e(N),null,{default:u(()=>[t(e(D),{labe:"key","label-hidden":"",modelValue:V.key,"onUpdate:modelValue":j=>V.key=j},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(e(N),null,{default:u(()=>[t(e(D),{labe:"value","label-hidden":"",modelValue:V.value,"onUpdate:modelValue":j=>V.value=j},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(e(N),null,{default:u(()=>[o.value.length!=r+1?(d(),_(e(T),{key:0,icon:e(de),onClick:j=>f(r)},null,8,["icon","onClick"])):$("",!0)]),_:2},1024)]),_:2},1032,["id","position"])]),_:1},8,["rows"])]),_:1})]),_:1},8,["open"]),l.value?(d(),U("div",Ue,[t(e(G),{tone:"critical"},{default:u(()=>[w("p",null,q(l.value.response?l.value.response.data:l.value.message),1)]),_:1})])):$("",!0),e(i).data.exception?(d(),U("div",Te,[t(e(G),{tone:"critical"},{default:u(()=>[w("p",null,q(e(i).data.exception),1)]),_:1})])):$("",!0)],64)):n.value==1?(d(),U(H,{key:1},[e(i).data.sended?(d(),_(e(J),{key:0,gap:"300"},{default:u(()=>[t(e(S),{gap:"200"},{default:u(()=>[!e(i).data.exception&&e(i).data.sended==1?(d(),_(e(re),{key:0,tone:"success"},{default:u(()=>[F("\u6210\u529F ")]),_:1})):(d(),_(e(re),{key:1,tone:"critical"},{default:u(()=>[F("\u5F02\u5E38")]),_:1}))]),_:1}),t(e(M)),t(e(S),{gap:"200",align:"space-between"},{default:u(()=>{var r;return[t(e(T),{variant:"plain",onClick:A},{default:u(()=>[F("\u54CD\u5E94\u5185\u5BB9")]),_:1}),(r=e(i).data.response)!=null&&r.body?(d(),_(e(T),{key:0,onClick:B,icon:e(Ce)},null,8,["icon"])):$("",!0)]}),_:1}),t(e(se),{open:h.value,"onUpdate:open":s[6]||(s[6]=r=>h.value=r),id:"responseBodyContent"},{default:u(()=>[t(e(I),null,{default:u(()=>[t(e(Ee),{shadow:"",style:{height:"300px",width:"100%"}},{default:u(()=>{var r;return[w("pre",null,[w("code",Se,q((r=e(i).data.response)==null?void 0:r.body),1)])]}),_:1})]),_:1})]),_:1},8,["open"]),t(e(M)),t(e(S),null,{default:u(()=>[t(e(T),{variant:"plain",onClick:s[7]||(s[7]=r=>m.value=!m.value)},{default:u(()=>[F("\u54CD\u5E94\u5934\u90E8")]),_:1})]),_:1}),t(e(se),{open:m.value,"onUpdate:open":s[8]||(s[8]=r=>m.value=r),id:"responseHeadersContent"},{default:u(()=>[t(e(I),{style:{"margin-top":"10px"}},{default:u(()=>[t(e(K),{"resource-name":{singular:"responseHeaders",plural:"responseHeaders"},headings:[{title:"\u952E"},{title:"\u503C"}],rows:e(i).responseHeaders,"last-column-sticky":"",selectable:!1},{default:u(({index:r,row:V})=>[t(e(z),{id:V.id,position:r},{default:u(()=>[t(e(N),null,{default:u(()=>[F(q(V.key),1)]),_:2},1024),t(e(N),null,{default:u(()=>[F(q(V.value),1)]),_:2},1024),t(e(N),null,{default:u(()=>[t(e(T),{icon:e(de)},null,8,["icon"])]),_:1})]),_:2},1032,["id","position"])]),_:1},8,["rows"])]),_:1})]),_:1},8,["open"])]),_:1})):$("",!0)],64)):$("",!0)])]),_:1})]),_:1}))}}),we=w("div",{style:{width:"30px","text-align":"center"}}," - ",-1),Pe={key:0},Oe=Q({__name:"HtmlUrlRule",props:{index:{}},emits:["update:urls","dismiss","update:rule"],setup(c,{emit:p}){var pe,ve;const n=X(),a=c,l=E(n.getRuleByPosition(a.index)),b=E(),m=ae(),h=[{content:"\u533A\u57DF\u622A\u53D6",id:"area",fields:{start:{text:"\u5F00\u59CB",required:!0},end:{text:"\u7ED3\u675F",required:!0}},description:"\u901A\u8FC7\u524D\u540E\u5B57\u6BB5\u622A\u53D6\u5185\u5BB9\uFF0C\u627E\u51FA\u5185\u5BB9\u4E2D\u6240\u6709\u94FE\u63A5\u3002"},{content:"\u5B57\u7B26\u622A\u53D6",id:"substr",fields:{start:{text:"\u5F00\u59CB",required:!0},end:{text:"\u7ED3\u675F",required:!0}},description:"\u901A\u8FC7\u524D\u540E\u5B57\u6BB5\u4E2D\u7684\u5185\u5BB9\uFF0C\u5FAA\u73AF\u627E\u5230\u5185\u5BB9\u4F5C\u4E3A\u94FE\u63A5\u3002"},{content:"\u6B63\u5219\u5339\u914D",id:"regular",fields:{start:{text:"\u6B63\u5219\u8868\u8FBE\u5F0F",required:!0},end:{text:"\u5408\u6210\u53C2\u6570",required:!0}},description:"\u901A\u8FC7\u6B63\u5219\uFF0C\u5FAA\u73AF\u627E\u5230\u5185\u5BB9\u4F5C\u4E3A\u94FE\u63A5\u3002"},{content:"\u6E90\u7801query\u5199\u6CD5",id:"dom_jquery",fields:{start:{text:"\u8282\u70B9",required:!0},end:{text:"\u8868\u8FBE\u5F0F",required:!0}},description:"\u901A\u8FC7jquery\u8868\u8FBE\u5F0F\uFF0C\u5FAA\u73AF\u627E\u5230\u5185\u5BB9\u4F5C\u4E3A\u94FE\u63A5\u3002"},{content:"json\u5206\u6790",id:"json",fields:{start:{text:"\u8282\u70B9",required:!0},end:{text:"key",required:!0}},description:"\u901A\u8FC7jquery\u8868\u8FBE\u5F0F\uFF0C\u5FAA\u73AF\u627E\u5230\u5185\u5BB9\u4F5C\u4E3A\u94FE\u63A5\u3002"}],i=x({get(){return h.findIndex(k=>l.value.content.type==k.id)||0},set(k){l.value.content.type=h[k].id,b.value=void 0}}),g=x(()=>h[i.value]),o=x({get(){return g.value.id=="dom_jquery"||g.value.id=="json"?Array.isArray(l.value.content.range.args):!1},set(k){k?l.value.content.range.args||(l.value.content.range.args=[]):l.value.content.range.args&&delete l.value.content.range.args}}),f=x(()=>{if(g.value.id=="dom_jquery"||g.value.id=="json")return{content:o.value?"\u53D6\u6D88\u53C2\u6570":"\u8BBE\u7F6E\u53C2\u6570",onAction:()=>{o.value=!o.value}}}),v=x(()=>{for(let k in g.value.fields)if(!l.value.content.range[k])return!0;return!1}),A=x(()=>{switch(l.value.type){case"product_list":return"\u5217\u8868\u9875\u83B7\u53D6\u89C4\u5219";case"product_url":return"\u4EA7\u54C1\u94FE\u63A5\u83B7\u53D6\u89C4\u5219";case"product_list_next":return"\u4E0B\u4E00\u9875\u83B7\u53D6\u89C4\u5219(\u81EA\u52A8\u5FAA\u73AF)";case"product_list_more":return"\u66F4\u591A\u9875\u83B7\u53D6\u89C4\u5219";default:return"\u89C4\u5219\u4E22\u5931"}}),B=E(""),y=()=>{B.value&&(Array.isArray(l.value.content.range.args)||(l.value.content.range.args=[]),l.value.content.range.args.push(B.value),B.value="")},s=E(""),r=E(Array.isArray(l.value.content.no_text)&&l.value.content.no_text.length>0),V=()=>{s.value&&(Array.isArray(l.value.content.no_text)||(l.value.content.no_text=[]),l.value.content.no_text.push(s.value),s.value="")},j=k=>{r.value=k,k||(l.value.content.no_text=[])},ne=E(Boolean((pe=l.value.content)==null?void 0:pe.custom_url)),ye=k=>{ne.value=k,k||(l.value.content.custom_url="")},oe=E(Boolean(((ve=l.value.content)==null?void 0:ve.custom_method)=="post")),he=k=>{oe.value=k,k?l.value.content.custom_method="post":(l.value.content.custom_method="get",l.value.content.custom_post_body="")},be=()=>{b.value=void 0,n.updateRule(a.index,l.value).then(()=>{l.value=n.getRuleByPosition(a.index)})},Be=()=>{n.deleteRule(a.index)};return(k,R)=>(d(),_(e(G),{title:A.value,dismissable:"",onDismiss:Be},{default:u(()=>[t(e(le),{tabs:h,disabled:e(n).loading,selected:i.value,"onUpdate:selected":R[0]||(R[0]=C=>i.value=C),style:{"margin-top":"calc( -1 * var(--p-space-300) )"}},null,8,["disabled","selected"]),t(e(J),{gap:"200"},{default:u(()=>[t(e(M)),t(e(S),{gap:"200",align:"space-between","block-align":"center"},{default:u(()=>[w("p",null,q(g.value.description),1),t(e(T),{loading:e(n).loading,disabled:v.value,onClick:be,variant:"primary"},{default:u(()=>[F("\u4FDD\u5B58\u5E76\u6D4B\u8BD5\u94FE\u63A5 ")]),_:1},8,["loading","disabled"])]),_:1}),t(e(ee),null,{default:u(()=>[t(e(S),{gap:"200",align:"center","block-align":"center"},{default:u(()=>[t(e(D),{style:{flex:"1"},disabled:e(n).loading,label:g.value.fields.start.text,multiline:4,modelValue:l.value.content.range.start,"onUpdate:modelValue":R[1]||(R[1]=C=>l.value.content.range.start=C)},null,8,["disabled","label","modelValue"]),we,o.value?(d(),_(e(D),{key:1,style:{flex:"1"},label:"\u591A\u53C2\u6570",modelValue:B.value,"onUpdate:modelValue":R[3]||(R[3]=C=>B.value=C),onKeyup:ie(y,["enter"]),"label-action":f.value},te({_:2},[l.value.content.range.args?{name:"verticalContent",fn:u(()=>[t(e(S),{gap:"200",alignment:"start"},{default:u(()=>[(d(!0),U(H,null,L(l.value.content.range.args,(C,O)=>(d(),_(e(ce),{removable:"",onRemove:Y=>l.value.content.range.args.splice(O,1)},{default:u(()=>[F(q(C),1)]),_:2},1032,["onRemove"]))),256))]),_:1})]),key:"0"}:void 0]),1032,["modelValue","label-action"])):(d(),_(e(D),{key:0,style:{flex:"1"},disabled:e(n).loading,label:g.value.fields.end.text,multiline:4,modelValue:l.value.content.range.end,"onUpdate:modelValue":R[2]||(R[2]=C=>l.value.content.range.end=C),"label-action":f.value},null,8,["disabled","label","modelValue","label-action"]))]),_:1}),t(e(S),{gap:"300"},{default:u(()=>[t(e(W),{checked:l.value.content.html_entity_decode,onChange:R[4]||(R[4]=C=>l.value.content.html_entity_decode=C),label:"\u94FE\u63A5\u89E3\u7801\u8F6C\u8BD1"},null,8,["checked"]),t(e(W),{checked:r.value,onChange:j,label:"\u6392\u9664\u5B57\u7B26"},null,8,["checked"]),t(e(W),{checked:ne.value,onChange:ye,label:"\u81EA\u5B9A\u4E49\u94FE\u63A5"},null,8,["checked"]),t(e(W),{checked:oe.value,onChange:he,label:"POST"},null,8,["checked"])]),_:1}),r.value?(d(),_(e(D),{key:0,label:"\u4E0D\u5305\u542B\u5B57\u7B26",modelValue:s.value,"onUpdate:modelValue":R[5]||(R[5]=C=>s.value=C),onKeyup:ie(V,["enter"])},te({_:2},[l.value.content.no_text?{name:"verticalContent",fn:u(()=>[t(e(S),{gap:"200",alignment:"start"},{default:u(()=>[(d(!0),U(H,null,L(l.value.content.no_text,(C,O)=>(d(),_(e(ce),{removable:"",onRemove:Y=>l.value.content.no_text.splice(O,1)},{default:u(()=>[F(q(C),1)]),_:2},1032,["onRemove"]))),256))]),_:1})]),key:"0"}:void 0]),1032,["modelValue"])):$("",!0),ne.value?(d(),_(e(D),{key:1,label:"\u81EA\u5B9A\u4E49\u94FE\u63A5",modelValue:l.value.content.custom_url,"onUpdate:modelValue":R[6]||(R[6]=C=>l.value.content.custom_url=C)},null,8,["modelValue"])):$("",!0),oe.value?(d(),_(e(D),{key:2,label:"POST\u5185\u5BB9",modelValue:l.value.content.custom_post_body,"onUpdate:modelValue":R[7]||(R[7]=C=>l.value.content.custom_post_body=C)},null,8,["modelValue"])):$("",!0)]),_:1}),b.value?(d(),U("div",Pe,[t(e(G),{tone:"critical"},{default:u(()=>[w("pre",null,q(b.value),1)]),_:1})])):l.value.maps&&l.value.maps.length>0?(d(),_(e(ee),{key:1,padding:"0",title:"\u6293\u53D6\u94FE\u63A5"},{default:u(()=>[t(e(M)),t(e(K),{"resource-name":{singular:"url_maps",plural:"url_maps"},headings:[{title:"\u94FE\u63A5"},{title:""}],rows:l.value.maps,"last-column-sticky":"",selectable:!1},{default:u(({index:C,row:O})=>[t(e(z),{id:O.id,position:C},{default:u(()=>[t(e(N),null,{default:u(()=>{var Y,me;return[F(q((me=(Y=O.next)==null?void 0:Y.request)==null?void 0:me.url),1)]}),_:2},1024),t(e(N),null,{default:u(()=>[t(e(T),{onClick:Y=>e(m).push(`/webs/${O.id}`)},{default:u(()=>[F("\u6D4B\u8BD5")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["id","position"])]),_:1},8,["rows"])]),_:1})):$("",!0)]),_:1})]),_:1},8,["title"]))}}),Le=Q({__name:"HtmlUrl",props:{index:{}},emits:["update:urls","dismiss","update:rule"],setup(c,{emit:p}){var f;const n=(v=[])=>((v||v.length==0)&&v.push({url:"",name:""}),v.map((A,B)=>({id:`c_url_${B}`,...A}))),a=X(),l=c,b=ae(),m=E(a.getRuleByPosition(l.index)),h=E(n((f=m.value.content)==null?void 0:f.urls));ue(()=>h.value,(v,A)=>{A[A.length-1].url&&h.value.push({id:`rule_${A.length}`,url:"",name:""})},{deep:!0});const i=E();x(()=>{var v;return!((v=m.value.content)!=null&&v.range.start)});const g=()=>{i.value=void 0,m.value.content.urls=h.value.map(v=>({url:v.url,name:v.name})).filter(v=>v.url),m.value.content.type="urls",a.updateRule(l.index,m.value).then(()=>{var v;m.value=a.getRuleByPosition(l.index),h.value=n((v=m.value.content)==null?void 0:v.urls)})},o=()=>{a.deleteRule(l.index)};return(v,A)=>{const B=ke("NpDivider");return d(),_(e(G),{title:"\u6307\u5B9A\u94FE\u63A5",dismissable:"",onDismiss:o},{default:u(()=>[t(e(J),{gap:"200"},{default:u(()=>[t(e(ee),{padding:"0"},{default:u(()=>[t(e(K),{rows:h.value,headings:[{title:"\u76F8\u5173\u94FE\u63A5"},{title:"\u6307\u5B9A\u540D\u79F0"},{title:""}],selectable:!1},{default:u(({index:y,row:s})=>[t(e(z),{id:s.id,position:y},{default:u(()=>[t(e(N),null,{default:u(()=>[t(e(D),{labe:"key","label-hidden":"",modelValue:s.url,"onUpdate:modelValue":r=>s.url=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(e(N),null,{default:u(()=>[t(e(D),{labe:"value","label-hidden":"",modelValue:s.name,"onUpdate:modelValue":r=>s.name=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(e(N),null,{default:u(()=>[h.value.length!=y+1?(d(),_(e(T),{key:0,icon:e(de),onClick:r=>h.value.splice(y,1)},null,8,["icon","onClick"])):$("",!0)]),_:2},1024)]),_:2},1032,["id","position"])]),_:1},8,["rows"])]),_:1}),t(e(T),{loading:e(a).loading,onClick:g},{default:u(()=>[F("\u4FDD\u5B58")]),_:1},8,["loading"]),m.value.maps&&m.value.maps.length>0?(d(),_(e(ee),{key:0,padding:"0"},{default:u(()=>[t(B),t(e(K),{"resource-name":{singular:"url_maps",plural:"url_maps"},headings:[{title:"\u94FE\u63A5"},{title:""}],rows:m.value.maps,"last-column-sticky":"",selectable:!1},{default:u(({index:y,row:s})=>[t(e(z),{id:s.id,position:y},{default:u(()=>[t(e(N),null,{default:u(()=>{var r,V;return[F(q((V=(r=s.next)==null?void 0:r.request)==null?void 0:V.url),1)]}),_:2},1024),t(e(N),null,{default:u(()=>[t(e(T),{onClick:r=>e(b).push(`/webs/${s.id}`)},{default:u(()=>[F("\u6D4B\u8BD5")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1032,["id","position"])]),_:1},8,["rows"])]),_:1})):$("",!0)]),_:1})]),_:1})}}}),je=w("div",{style:{width:"30px","text-align":"center"}}," - ",-1),ge=Q({__name:"HtmlContentRule",props:{index:{},title:{}},emits:["update:urls","dismiss","update:rule"],setup(c,{emit:p}){const n=X(),a=c,l=x(()=>n.rules[a.index]),b=E();ae();const m=E(""),h=()=>{m.value&&(Array.isArray(l.value.content.no_text)||(l.value.content.no_text=[]),l.value.content.no_text.push(m.value),m.value="")},i=[{content:"\u533A\u57DF\u622A\u53D6",id:"area",fields:{start:{text:"\u5F00\u59CB",required:!0},end:{text:"\u7ED3\u675F",required:!0}},description:"\u901A\u8FC7\u524D\u540E\u5B57\u6BB5\u622A\u53D6\u5185\u5BB9\uFF0C\u627E\u51FA\u5185\u5BB9\u3002"},{content:"\u6B63\u5219\u5339\u914D",id:"regular",fields:{start:{text:"\u6B63\u5219\u8868\u8FBE\u5F0F",required:!0},end:{text:"\u5408\u6210\u53C2\u6570",required:!0}},description:"\u901A\u8FC7\u6B63\u5219\uFF0C\u5FAA\u73AF\u627E\u5230\u5185\u5BB9\u3002"},{content:"\u6E90\u7801query\u5199\u6CD5",id:"dom_jquery",fields:{start:{text:"\u5339\u914D\u8868\u8FBE\u5F0F(jquery)",required:!0},end:{text:"\u6807\u7B7E\u5C5E\u6027\uFF08href\uFF09",required:!0}},description:"\u901A\u8FC7jquery\u8868\u8FBE\u5F0F\uFF0C\u5FAA\u73AF\u627E\u5230\u5185\u5BB9\u4F5C\u4E3A\u94FE\u63A5\u3002"}],g=x({get(){return i.findIndex(B=>l.value.content.type==B.id)||0},set(B){l.value.content.type=i[B].id,b.value=void 0}}),o=x(()=>i[g.value]),f=x(()=>{for(let B in o.value.fields)if(!l.value.content.range[B])return!0;return!1}),v=()=>{b.value=void 0,n.updateRule(a.index,l.value).then(()=>{n.touchProduct()})},A=()=>{n.deleteRule(a.index)};return(B,y)=>(d(),_(e(G),{title:B.title,dismissable:"",onDismiss:A},{default:u(()=>[t(e(le),{tabs:i,disabled:e(n).loading,selected:g.value,"onUpdate:selected":y[0]||(y[0]=s=>g.value=s),style:{"margin-top":"calc( -1 * var(--p-space-300) )"}},null,8,["disabled","selected"]),t(e(J),{gap:"200"},{default:u(()=>[t(e(M)),t(e(S),{gap:"200",align:"space-between","block-align":"center"},{default:u(()=>[w("p",null,q(o.value.description),1),t(e(T),{loading:e(n).loading,disabled:f.value,onClick:v,variant:"primary"},{default:u(()=>[F("\u6D4B\u8BD5\u89C4\u5219 ")]),_:1},8,["loading","disabled"])]),_:1}),t(e(ee),null,{default:u(()=>[t(e(S),{gap:"200",align:"center","block-align":"center"},{default:u(()=>[t(e(D),{style:{flex:"1"},disabled:e(n).loading,label:o.value.fields.start.text,multiline:4,modelValue:l.value.content.range.start,"onUpdate:modelValue":y[1]||(y[1]=s=>l.value.content.range.start=s)},null,8,["disabled","label","modelValue"]),je,t(e(D),{style:{flex:"1"},disabled:e(n).loading,label:o.value.fields.end.text,multiline:4,modelValue:l.value.content.range.end,"onUpdate:modelValue":y[2]||(y[2]=s=>l.value.content.range.end=s)},null,8,["disabled","label","modelValue"])]),_:1}),t(e(S),{gap:"300"},{default:u(()=>[t(e(W),{checked:l.value.content.no_repeat,onChange:y[3]||(y[3]=s=>l.value.content.no_repeat=s),label:"\u53BB\u91CD"},null,8,["checked"]),t(e(W),{checked:l.value.content.no_params,onChange:y[4]||(y[4]=s=>l.value.content.no_params=s),label:"\u53BB\u53C2"},null,8,["checked"])]),_:1}),t(e(D),{label:"\u8FC7\u6EE4\u5B57\u7B26",modelValue:m.value,"onUpdate:modelValue":y[5]||(y[5]=s=>m.value=s),onKeyup:ie(h,["enter"])},te({_:2},[l.value.content.no_text?{name:"verticalContent",fn:u(()=>[t(e(S),{gap:"200",alignment:"start"},{default:u(()=>[(d(!0),U(H,null,L(l.value.content.no_text,(s,r)=>(d(),_(e(ce),{removable:"",onRemove:V=>l.value.content.no_text.splice(r,1)},{default:u(()=>[F(q(s),1)]),_:2},1032,["onRemove"]))),256))]),_:1})]),key:"0"}:void 0]),1032,["modelValue"])]),_:1})]),_:1})]),_:1},8,["title"]))}}),Ie=Q({__name:"ProductRules",setup(c){const p=X(),n=E("");p.touchProduct();const a=[{id:"name",content:"\u6807\u9898"},{id:"sku",content:"SKU"},{id:"category",content:"\u5206\u7C7B"},{id:"brand",content:"\u54C1\u724C"},{id:"shor_decription",content:"\u7B80\u4ECB"},{id:"decription",content:"\u63CF\u8FF0"},{id:"price",content:"\u73B0\u4EF7"},{id:"compare_at_price",content:"\u539F\u4EF7"},{id:"images",content:"\u56FE\u7247\u94FE\u63A5"},{id:"attributes",content:"\u5C5E\u6027"}],l=E(0),b=x(()=>a[l.value]);ue(()=>p.rules,()=>{for(let g of a)p.rules.filter(o=>o.type==`product_content_${g.id}`).length==0&&g.id!="attributes"&&p.addRule(`product_content_${g.id}`)},{immediate:!0});const m=x(()=>{let g=[];return p.rules.forEach((o,f)=>{if(o.type.indexOf(`product_content_${b.value.id}`)===0){let v=o.type.replace(`product_content_${b.value.id}`,"");g.push({title:`\u89C4\u5219\uFF1A${b.value.content} ${v}`,index:f})}}),g}),h=x(()=>{let g=[],o=0;return a.forEach(({id:f,content:v})=>{if(p.product&&p.product.content){for(let A of p.product.content)if(A.type.indexOf(f)===0){let B=A.type.replace(`product_content_${f}`,"");g.push({id:`${f}_${o}`,key:`${v} ${B}`,value:A.content}),o++}}else g.push({id:`${f}_${o}`,key:v,value:""}),o++}),g}),i=()=>{p.addRule(`product_content_attributes${n.value}`),n.value=""};return(g,o)=>(d(),U(H,null,[t(e(le),{tabs:a,disabled:e(p).loading,selected:l.value,"onUpdate:selected":o[0]||(o[0]=f=>l.value=f)},null,8,["disabled","selected"]),t(e(J),{gap:"200"},{default:u(()=>[b.value.id=="attributes"?(d(),_(e(S),{key:0,gap:"200","block-align":"start",align:"center"},{default:u(()=>[m.value.length?(d(),_(e(J),{key:0,gap:"200",style:{flex:"3"}},{default:u(()=>[(d(!0),U(H,null,L(m.value,f=>(d(),_(ge,{title:f.title,index:f.index},null,8,["title","index"]))),256))]),_:1})):$("",!0),t(e(I),{style:{flex:"1"},title:"\u65B0\u589E\u5C5E\u6027",sectioned:"","primary-footer-action":{content:"\u6DFB\u52A0",onAction:i,disabled:!Boolean(n.value)}},{default:u(()=>[t(e(D),{label:"","label-hidden":"",placeholder:"\u586B\u5199\u5C5E\u6027\u540D",modelValue:n.value,"onUpdate:modelValue":o[1]||(o[1]=f=>n.value=f)},null,8,["modelValue"])]),_:1},8,["primary-footer-action"])]),_:1})):(d(!0),U(H,{key:1},L(m.value,f=>(d(),_(ge,{title:f.title,index:f.index},null,8,["title","index"]))),256)),t(e(I),null,{default:u(()=>[t(e(K),{"resource-name":{singular:"\u4EA7\u54C1\u5185\u5BB9",plural:"\u4EA7\u54C1\u5185\u5BB9"},loading:e(p).productLoading,headings:[{title:"\u952E"},{title:"\u503C"}],rows:h.value,selectable:!1},{default:u(({index:f,row:v})=>[t(e(z),{id:v.id,position:f},{default:u(()=>[t(e(N),null,{default:u(()=>[F(q(v.key),1)]),_:2},1024),t(e(N),null,{default:u(()=>[F(q(v.value),1)]),_:2},1024)]),_:2},1032,["id","position"])]),_:1},8,["loading","rows"])]),_:1})]),_:1})],64))}}),Ke=Q({__name:"TaskWeb",setup(c){const p=ae(),n=Re(),a=X();ue(()=>n.params.id,()=>{a.get(n.params.id)},{immediate:!0});const l={content:"\u8FD4\u56DE",onAction:()=>{p.back()}},b=x(()=>{var f;switch((f=a.prevRule)==null?void 0:f.type){case"home":return"\u521D\u59CB\u9875\u5206\u6790";case"product_list":return"\u5217\u8868\u9875\u5206\u6790";case"product_list_next":return"\u5217\u8868\u4E0B\u4E00\u9875\u5206\u6790";case"product_list_more":return"\u66F4\u591A\u9875\u5206\u6790";case"product_url":return"\u4EA7\u54C1\u9875\u9762";default:return"\u9875\u9762\u5206\u6790"}}),m=x(()=>{let o=[];return!a.map||a.map.source_id=="0"?(o.push({type:"custom_list_url",content:"\u6307\u5B9A\u5217\u8868\u9875"}),o.push({type:"product_list",content:"\u5217\u8868\u9875\u94FE\u63A5"})):(a.prevRule.type=="product_list"||a.prevRule.type=="custom_list_url"||a.prevRule.type=="product_list_more")&&(o.push({type:"product_list_next",content:"\u4E0B\u4E00\u9875"}),o.push({type:"product_list_more",content:"\u66F4\u591A\u9875"}),o.push({type:"product_url",content:"\u4EA7\u54C1\u94FE\u63A5"})),o}),h=x(()=>{if(!a.map.source_id||a.map.source_id=="0"){let o=[];return a.prevRule.type=="home"&&a.rules.length==0&&o.push({content:"\u6807\u8BB0\u4E3AShopify\u9879\u76EE",onAction:()=>i("shopify_home")}),a.prevRule.type=="shopify_home"&&a.rules.length==0&&o.push({content:"\u6807\u8BB0\u4E3A\u666E\u901A\u9879\u76EE",onAction:()=>i("home")}),o}}),i=o=>{a.updateRuleType(o)},g=o=>{a.addRule(o)};return(o,f)=>e(a).firstLoading||!e(a).map.id?(d(),_(e(qe),{key:0,"primary-action":""},{default:u(()=>[t(e(fe),null,{default:u(()=>[t(e(Z),null,{default:u(()=>[t(e(De))]),_:1})]),_:1})]),_:1})):(d(),_(e(Ne),{key:1,title:b.value,"back-action":l,"secondary-actions":h.value},te({default:u(()=>[t(e($e),{action:"post",style:{"margin-bottom":"50px"}},{default:u(()=>[t(e(fe),null,{default:u(()=>{var v;return[t(e(Z),null,{default:u(()=>[t(He)]),_:1}),e(a).data.id&&(e(a).data.sended||e(a).prevRule&&e(a).rules.length>0)?(d(),U(H,{key:0},[((v=e(a).prevRule)==null?void 0:v.type)!=="product_url"?(d(),U(H,{key:0},[t(e(Z),null,{default:u(()=>[t(e(Ve),null,{default:u(()=>[(d(!0),U(H,null,L(m.value,A=>(d(),_(e(T),{onClick:B=>g(A.type)},{default:u(()=>[F("\u6DFB\u52A0"+q(A.content)+"\u89C4\u5219 ",1)]),_:2},1032,["onClick"]))),256))]),_:1})]),_:1}),(d(!0),U(H,null,L(e(a).rules,(A,B)=>(d(),_(e(Z),null,{default:u(()=>[A.type=="custom_list_url"?(d(),_(Le,{key:0,index:B},null,8,["index"])):(d(),_(Oe,{key:1,index:B},null,8,["index"]))]),_:2},1024))),256))],64)):(d(),_(e(Z),{key:1},{default:u(()=>[t(Ie)]),_:1}))],64)):$("",!0)]}),_:1})]),_:1})]),_:2},[e(a).prevRule.type=="shopify_home"?{name:"titleMetadata",fn:u(()=>[t(e(re),{tone:"attention"},{default:u(()=>[F("Shopify")]),_:1})]),key:"0"}:void 0]),1032,["title","secondary-actions"]))}});export{Ke as default};
